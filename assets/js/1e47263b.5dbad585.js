"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5461],{2584:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>o,contentTitle:()=>d,default:()=>a,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var c=e(4848),s=e(8453);const r={},d=void 0,i={id:"cpp/async",title:"async",description:"std::async",source:"@site/docs/cpp/async.md",sourceDirName:"cpp",slug:"/cpp/async",permalink:"/docs/cpp/async",draft:!1,unlisted:!1,editUrl:"https://github.com/1036-ce/1036-ce.github.io/blob/main/docs/cpp/async.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"cmake and gtest",permalink:"/docs/cmake/cmake_and_gtest"},next:{title:"\u6df1\u5165\u7406\u89e3co_await",permalink:"/docs/cpp/coroutines/co_await"}},o={},l=[{value:"std::async",id:"stdasync",level:2},{value:"std::future",id:"stdfuture",level:2},{value:"method",id:"method",level:3},{value:"std::launch",id:"stdlaunch",level:2}];function u(n){const t={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(t.h2,{id:"stdasync",children:"std::async"}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.code,{children:"std::async"})," \u5f02\u6b65\u8fd0\u884c\u4e00\u4e2a\u51fd\u6570\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a",(0,c.jsx)(t.strong,{children:"\u643a\u5e26\u76ee\u6807\u51fd\u6570\u8fd4\u56de\u503c"}),"\uff08",(0,c.jsx)(t.code,{children:"std::thread"}),"\u4e0d\u5141\u8bb8\u6709\u8fd4\u56de\u503c\uff09\u7684",(0,c.jsx)(t.code,{children:"std::future"}),"\u5bf9\u8c61"]}),"\n",(0,c.jsx)(t.h2,{id:"stdfuture",children:"std::future"}),"\n",(0,c.jsx)(t.h3,{id:"method",children:"method"}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.code,{children:"get()"}),": \u7528\u4e8e\u53d6\u51fa\u76ee\u6807\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c",(0,c.jsx)(t.code,{children:"get()"}),"\u662f\u963b\u585e\u5f0f\u7684\uff0c\u4f1a\u7b49\u5230\u5f02\u6b65\u51fd\u6570\u5b8c\u6210"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.code,{children:"wait()"}),": \u7b49\u5f85\u76f4\u5230\u7ed3\u679c\u53ef\u7528\uff0c\u963b\u585e\u5f0f"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.code,{children:"wait_for()"}),": \u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.code,{children:"wait_until()"}),": \u7b49\u5f85\u76f4\u5230\u67d0\u4e2a\u6307\u5b9a\u7684",(0,c.jsx)(t.strong,{children:"\u65f6\u523b"})]}),"\n"]}),"\n",(0,c.jsx)(t.h2,{id:"stdlaunch",children:"std::launch"}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.code,{children:"std::launch"})," \u662f\u4e00\u4e2a\u679a\u4e3e\uff0c\u5305\u542b",(0,c.jsx)(t.code,{children:"async"}),"\u548c",(0,c.jsx)(t.code,{children:"deferred"})]}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.code,{children:"async"}),"\u6807\u5fd7\u542f\u7528\u5f02\u6b65\u64cd\u4f5c"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.code,{children:"deferred"})," \u6807\u5fd7\u542f\u7528\u5ef6\u8fdf\u8ba1\u7b97\uff0c\u5728\u8c03\u7528",(0,c.jsx)(t.code,{children:"std::future"}),"\u7684",(0,c.jsx)(t.code,{children:"get"}),"\u51fd\u6570\u65f6\u624d\u6267\u884c\u51fd\u6570\n",(0,c.jsx)(t.code,{children:"async"}),"\u548c",(0,c.jsx)(t.code,{children:"deferred"}),"\u662f\u4f4d\u6620\u5c04\u7684\uff0c\u53ef\u4ee5\u6309\u4f4d\u6216:",(0,c.jsx)(t.code,{children:"async | deferred"})," \uff08\u9ed8\u8ba4\u503c\uff09"]}),"\n"]}),"\n",(0,c.jsx)(t.p,{children:"\u793a\u4f8b\u4ee3\u7801\uff1a"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-cpp",children:'#include <chrono>\n#include <fmt/core.h>\n#include <fmt/chrono.h>\n#include <future>\n#include <iostream>\n\nusing launch = std::launch;\nusing secs   = std::chrono::duration<double>;\n\nstruct prime_time {\n\tsecs dur{};\n\tuint64_t count{};\n};\n\nprime_time count_primes(const uint64_t &max) {\n\tprime_time ret{};\n\tconstexpr auto isprime = [](const uint64_t &n) {\n\t\tfor (uint64_t i{2}; i < n / 2; ++i) {\n\t\t\tif (n % i == 0)\n\t\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t};\n\tuint64_t start{2};\n\tuint64_t end{max};\n\tauto t1 = std::chrono::steady_clock::now();\n\tfor (uint64_t i{start}; i <= end; ++i) {\n\t\tif (isprime(i))\n\t\t\t++ret.count;\n\t}\n\tret.dur = std::chrono::steady_clock::now() - t1;\n\treturn ret;\n}\n\nint main() {\n\tconstexpr uint64_t MAX_PRIME{0x1ffff};\n\tauto primes1 = std::async(launch::deferred, count_primes, MAX_PRIME);\n\tauto pt = primes1.get();\n\tstd::cout << fmt::format("primes: {} {:.3}\\n", pt.count, pt.dur);\n\treturn 0;\n}\n'})})]})}function a(n={}){const{wrapper:t}={...(0,s.R)(),...n.components};return t?(0,c.jsx)(t,{...n,children:(0,c.jsx)(u,{...n})}):u(n)}},8453:(n,t,e)=>{e.d(t,{R:()=>d,x:()=>i});var c=e(6540);const s={},r=c.createContext(s);function d(n){const t=c.useContext(r);return c.useMemo((function(){return"function"==typeof n?n(t):{...t,...n}}),[t,n])}function i(n){let t;return t=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:d(n.components),c.createElement(r.Provider,{value:t},n.children)}}}]);