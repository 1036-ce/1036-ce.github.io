"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9415],{5547:(n,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var e=i(4848),d=i(8453);const r={},o=void 0,a={id:"cpp/conditional_variable",title:"conditional_variable",description:"conditional variable",source:"@site/docs/cpp/conditional_variable.md",sourceDirName:"cpp",slug:"/cpp/conditional_variable",permalink:"/docs/cpp/conditional_variable",draft:!1,unlisted:!1,editUrl:"https://github.com/1036-ce/1036-ce.github.io/blob/main/docs/cpp/conditional_variable.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"async",permalink:"/docs/cpp/async"},next:{title:"const",permalink:"/docs/cpp/const"}},c={},l=[{value:"conditional variable",id:"conditional-variable",level:2},{value:"api",id:"api",level:3},{value:"usage",id:"usage",level:3}];function s(n){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,d.R)(),...n.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.h2,{id:"conditional-variable",children:"conditional variable"}),"\n",(0,e.jsxs)(t.p,{children:[(0,e.jsx)(t.code,{children:"std::conditional_variable"}),"\u662fc++11\u5f15\u5165\u7684\u540c\u6b65\u539f\u8bed\uff0c\u4e3b\u8981\u7528\u4e8e\u7ebf\u7a0b\u4e4b\u95f4\u7684\u7b49\u5f85\u548c\u901a\u77e5\u3002\n\u5176\u5185\u90e8\u5b9e\u73b0\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u540c\u6b65\u673a\u5236\uff08\u5728linux\u4e0a\u662fpthread_cond_t)"]}),"\n",(0,e.jsx)(t.h3,{id:"api",children:"api"}),"\n",(0,e.jsxs)(t.ol,{children:["\n",(0,e.jsx)(t.li,{children:"notify_one: \u5524\u9192\u4e00\u4e2a\u963b\u585e\u7684\u7ebf\u7a0b"}),"\n",(0,e.jsx)(t.li,{children:"notify_all: \u5524\u9192\u6240\u6709\u963b\u585e\u7684\u7ebf\u7a0b"}),"\n",(0,e.jsx)(t.li,{children:"wait: \u963b\u585e\u76f4\u5230\u88ab\u5524\u9192"}),"\n",(0,e.jsx)(t.li,{children:"wait_for: \u963b\u585e\u5f53\u524d\u7ebf\u7a0b\u76f4\u5230\u88ab\u5524\u9192\u6216\u8d85\u65f6"}),"\n",(0,e.jsx)(t.li,{children:"wait_until: \u963b\u585e\u5f53\u524d\u7ebf\u7a0b\u76f4\u5230\u88ab\u5524\u9192\u6216\u5230\u8fbe\u6307\u5b9a\u65f6\u95f4"}),"\n"]}),"\n",(0,e.jsx)(t.h3,{id:"usage",children:"usage"}),"\n",(0,e.jsx)(t.p,{children:"\u4f7f\u7528conditional_variable\u5b9e\u73b0\u4ea4\u66ff\u6253\u5370\u6570\u5b57"}),"\n",(0,e.jsx)(t.pre,{children:(0,e.jsx)(t.code,{className:"language-cpp",children:'#include <condition_variable>\n#include <cstdio>\n#include <thread>\n\nusing namespace std::chrono_literals;\n\nstd::mutex m;\nstd::condition_variable cv;\nint turn = 1;\n\nuint32_t tid2uint(std::thread::id tid) {\n  return *reinterpret_cast<uint32_t*>(&tid) % 100;\n}\n\nvoid print_odd() {\n  auto tid = tid2uint(std::this_thread::get_id());\n  std::unique_lock<std::mutex> ul(m);\n  int num = 1;\n  while (true) {\n    cv.wait(ul, []() { return turn == 0; });\n    printf("%d: %d\\n", tid, num);\n    std::this_thread::sleep_for(1s);\n    num += 2;\n    turn = 1;\n    cv.notify_one();\n  }\n}\n\nvoid print_even() {\n  auto tid = tid2uint(std::this_thread::get_id());\n  std::unique_lock<std::mutex> ul(m);\n  int num = 0;\n  while (true) {\n    cv.wait(ul, []() { return turn == 1; });\n    printf("%d: %d\\n", tid, num);\n    std::this_thread::sleep_for(1s);\n    num += 2;\n    turn = 0;\n    cv.notify_one();\n  }\n}\n\nint main() {\n  std::thread t1(print_even);\n  std::thread t0(print_odd);\n  printf("t0\'s tid is %d, t1\'s tid is %d\\n", tid2uint(t0.get_id()), tid2uint(t1.get_id()));\n  t1.join();\n  t0.join();\n  return 0;\n}\n'})}),"\n",(0,e.jsxs)(t.blockquote,{children:["\n",(0,e.jsx)(t.p,{children:(0,e.jsx)(t.a,{href:"https://en.cppreference.com/w/cpp/thread/condition_variable",children:"cppreference"})}),"\n"]})]})}function u(n={}){const{wrapper:t}={...(0,d.R)(),...n.components};return t?(0,e.jsx)(t,{...n,children:(0,e.jsx)(s,{...n})}):s(n)}},8453:(n,t,i)=>{i.d(t,{R:()=>o,x:()=>a});var e=i(6540);const d={},r=e.createContext(d);function o(n){const t=e.useContext(r);return e.useMemo((function(){return"function"==typeof n?n(t):{...t,...n}}),[t,n])}function a(n){let t;return t=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:o(n.components),e.createElement(r.Provider,{value:t},n.children)}}}]);